// Copyright (c) 2020 smarsu. All Rights Reserved.

#include "pool.h"

#define NRAM_REMAIN_SIZE (1024 + 128)
#define NRAM_BUF_SIZE (512 * 1024 - NRAM_REMAIN_SIZE)

__mlu_entry__ void pool_entry(void *src,
                              void *dst,
                              int ni,
                              int hi,
                              int wi,
                              int ci,
                              int no,
                              int ho,
                              int wo,
                              int co,
                              int hf,
                              int wf,
                              int hs,
                              int ws,
                              PoolMode mode,
                              DataType dtype) {
  __nram__ int8_t nram_buf[NRAM_BUF_SIZE];

#define POOL(T) \
    pool<T>((T *)src, \
            (T *)dst, \
            ni, \
            hi, \
            wi, \
            ci, \
            no, \
            ho, \
            wo, \
            co, \
            hf, \
            wf, \
            hs, \
            ws, \
            NRAM_BUF_SIZE, \
            mode, \
            (T *)nram_buf);

  if (dtype == DataType::kFloat32) {
    POOL(float);
  }

#undef POOL
}
